<!DOCTYPE html>
<html lang="ur" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…ÛŒØ±Ø§ Ø¬ÛÙ„Ù… - Ø§Ù†ØªØ¸Ø§Ù…ÛŒÛ</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <style>
        :root { --primary: #004D40; --accent: #D4AF37; }
        body { margin: 0; background: #f0f2f5; font-family: 'Segoe UI'; padding-bottom: 80px; }
        .profile-header { background: var(--primary); color: white; padding: 30px 20px; text-align: center; border-radius: 0 0 30px 30px; }
        .user-img { width: 80px; height: 80px; border-radius: 50%; border: 3px solid var(--accent); margin-bottom: 5px; }
        
        /* Tab System Styling */
        .tabs { display: flex; background: white; margin: -20px 20px 20px 20px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); overflow: hidden; }
        .tab-btn { flex: 1; padding: 15px; border: none; background: none; font-weight: bold; cursor: pointer; color: #666; transition: 0.3s; }
        .tab-btn.active { background: var(--accent); color: var(--primary); }
        
        .form-section { display: none; padding: 0 20px; }
        .form-section.active { display: block; }

        .form-card { background: white; padding: 25px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 20px; }
        h3 { color: var(--primary); margin-top: 0; font-size: 1.2rem; }
        .input-group { margin-bottom: 12px; }
        input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; font-family: inherit; }
        .btn-publish { background: var(--primary); color: white; border: none; width: 100%; padding: 15px; border-radius: 10px; font-weight: bold; font-size: 16px; cursor: pointer; }
        
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: white; display: flex; justify-content: space-around; padding: 15px 0; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); }
        .nav-item { text-decoration: none; color: #666; font-size: 14px; text-align: center; }
    </style>
</head>
<body>

    <div class="profile-header">
        <img id="display-photo" src="https://via.placeholder.com/100" class="user-img">
        <h2 id="display-name" style="margin: 5px 0;">Ù„ÙˆÚˆ ÛÙˆ Ø±ÛØ§ ÛÛ’...</h2>
    </div>

    <div class="tabs">
        <button class="tab-btn active" onclick="openTab(event, 'rate-list-sec')">Ø±ÛŒÙ¹ Ù„Ø³Ù¹ Ø§Ù¾Ù„ÙˆÚˆ</button>
        <button class="tab-btn" onclick="openTab(event, 'shop-reg-sec')">Ø¯Ú©Ø§Ù† Ø±Ø¬Ø³Ù¹Ø±ÛŒØ´Ù†</button>
    </div>

    <div id="rate-list-sec" class="form-section active">
        <div class="form-card">
            <h3>ØªØ§Ø²Û Ø±ÛŒÙ¹ Ù„Ø³Ù¹ Ù„Ú¯Ø§Ø¦ÛŒÚº ğŸ“</h3>
            <div class="input-group">
                <input type="text" id="item-name" placeholder="Ù¾Ø±ÙˆÚˆÚ©Ù¹ Ú©Ø§ Ù†Ø§Ù… (Ù…Ø«Ù„Ø§Ù‹: Ø¢Ù„ÙˆØŒ Ú†Ú©Ù†)">
            </div>
            <div class="input-group">
                <input type="number" id="item-price" placeholder="Ù‚ÛŒÙ…Øª (Rs.)">
            </div>
            <div class="input-group">
                <label style="font-size: 13px; color: grey;">Ù¾Ø±ÙˆÚˆÚ©Ù¹ Ú©ÛŒ ØªØµÙˆÛŒØ±:</label>
                <input type="file" id="item-image" accept="image/*" style="border: none;">
            </div>
            <button id="publish-rate-btn" onclick="publishRate()" class="btn-publish" style="background: #2e7d32;">Ù„Ø§Ø¦ÛŒÙˆ Ù¾Ø¨Ù„Ø´ Ú©Ø±ÛŒÚº ğŸš€</button>
        </div>
    </div>

    <div id="shop-reg-sec" class="form-section">
        <div class="form-card">
            <h3>Ø§Ù¾Ù†ÛŒ Ø¯Ú©Ø§Ù† Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº ğŸª</h3>
            <div class="input-group">
                <input type="text" id="shop-name" placeholder="Ø¯Ú©Ø§Ù† Ú©Ø§ Ù†Ø§Ù…">
            </div>
            <div class="input-group">
                <input type="text" id="map-link" placeholder="Ú¯ÙˆÚ¯Ù„ Ù…ÛŒÙ¾ Ù„Ù†Ú©">
            </div>
            <div class="input-group">
                <label style="font-size: 13px; color: grey;">Ø¯Ú©Ø§Ù† Ú©ÛŒ ØªØµÙˆÛŒØ±:</label>
                <input type="file" id="shop-image" accept="image/*" style="border: none;">
            </div>
            <button id="save-shop-btn" onclick="saveShopData()" class="btn-publish">Ø¯Ú©Ø§Ù† Ù…Ø­ÙÙˆØ¸ Ú©Ø±ÛŒÚº</button>
        </div>
    </div>

    <nav class="bottom-nav">
        <a href="home.html" class="nav-item">ğŸ <br>ÛÙˆÙ…</a>
        <a href="ratelist.html" class="nav-item">ğŸ“‹<br>Ø±ÛŒÙ¹ Ù„Ø³Ù¹</a>
        <a href="shops.html" class="nav-item">ğŸ›’<br>Ø¯Ú©Ø§Ù†ÛŒÚº</a>
        <a href="profile.html" class="nav-item active" style="color: var(--primary); font-weight: bold;">ğŸ‘¤<br>Ù¾Ø±ÙˆÙØ§Ø¦Ù„</a>
    </nav>

    <script>
        // --- CONFIGURATIONS ---
        const firebaseConfig = {
            apiKey: "AIzaSyDey-KaC_Ty-dqijuQMWeQjtUx3eaaXc6k",
            authDomain: "mera-jehlum.firebaseapp.com",
            databaseURL: "https://mera-jehlum-default-rtdb.firebaseio.com",
            projectId: "mera-jehlum",
            storageBucket: "mera-jehlum.firebasestorage.app",
            messagingSenderId: "1093409222171",
            appId: "1:1093409222171:web:e9c1d2113c6bb7ae2952be"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const CLOUDINARY_URL = "https://api.cloudinary.com/v1_1/dxhiopwak/image/upload";
        const CLOUDINARY_PRESET = "meranjehlum";

        // Tab Switch Logic
        function openTab(evt, sectionName) {
            let i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("form-section");
            for (i = 0; i < tabcontent.length; i++) tabcontent[i].classList.remove("active");
            tablinks = document.getElementsByClassName("tab-btn");
            for (i = 0; i < tablinks.length; i++) tablinks[i].classList.remove("active");
            document.getElementById(sectionName).classList.add("active");
            evt.currentTarget.classList.add("active");
        }

        // Profile Loading
        document.getElementById('display-name').innerText = localStorage.getItem("user_name") || "ØµØ§Ø±Ù";
        document.getElementById('display-photo').src = localStorage.getItem("user_photo") || "https://via.placeholder.com/100";

        // Logic to upload to Cloudinary
        async function uploadImage(file) {
            const formData = new FormData();
            formData.append('file', file);
            formData.append('upload_preset', CLOUDINARY_PRESET);
            const res = await fetch(CLOUDINARY_URL, { method: 'POST', body: formData });
            const json = await res.json();
            return json.secure_url;
        }

        // 1. Publish Rate Logic
        async function publishRate() {
            const btn = document.getElementById('publish-rate-btn');
            const name = document.getElementById('item-name').value;
            const price = document.getElementById('item-price').value;
            const file = document.getElementById('item-image').files[0];

            if(!name || !price || !file) return alert("Ø¨Ø±Ø§Û Ú©Ø±Ù… Ø±ÛŒÙ¹ Ú©ÛŒ ØªÙ…Ø§Ù… Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù¾ÙØ± Ú©Ø±ÛŒÚº!");

            btn.innerText = "Ù¾Ø¨Ù„Ø´ ÛÙˆ Ø±ÛØ§ ÛÛ’...";
            btn.disabled = true;

            try {
                const imgUrl = await uploadImage(file);
                await db.ref('mandi_rates').push({
                    name_ur: name,
                    price: price,
                    image_url: imgUrl,
                    time: new Date().toLocaleTimeString()
                });
                alert("Ø±ÛŒÙ¹ Ù„Ø³Ù¹ Ù„Ø§Ø¦ÛŒÙˆ Ú©Ø± Ø¯ÛŒ Ú¯Ø¦ÛŒ ÛÛ’!");
                window.location.href = "ratelist.html";
            } catch (err) { alert("Error!"); console.error(err); }
            finally { btn.innerText = "Ù„Ø§Ø¦ÛŒÙˆ Ù¾Ø¨Ù„Ø´ Ú©Ø±ÛŒÚº ğŸš€"; btn.disabled = false; }
        }

        // 2. Save Shop Logic (Existing)
        async function saveShopData() {
            const btn = document.getElementById('save-shop-btn');
            const shopName = document.getElementById('shop-name').value;
            const mapLink = document.getElementById('map-link').value;
            const file = document.getElementById('shop-image').files[0];

            if(!shopName || !file) return alert("Ø¯Ú©Ø§Ù† Ú©ÛŒ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…Ú©Ù…Ù„ Ú©Ø±ÛŒÚº!");

            btn.innerText = "Ø³ÛŒÙˆ ÛÙˆ Ø±ÛØ§ ÛÛ’...";
            btn.disabled = true;

            try {
                const imgUrl = await uploadImage(file);
                await db.ref('shops').push({
                    shop_name: shopName,
                    map_link: mapLink,
                    image_url: imgUrl,
                    rating: 5.0
                });
                alert("Ø¯Ú©Ø§Ù† Ø±Ø¬Ø³Ù¹Ø± ÛÙˆ Ú¯Ø¦ÛŒ!");
                window.location.href = "shops.html";
            } catch (err) { alert("Error!"); }
            finally { btn.innerText = "Ø¯Ú©Ø§Ù† Ù…Ø­ÙÙˆØ¸ Ú©Ø±ÛŒÚº"; btn.disabled = false; }
        }
    </script>
</body>
</html>
