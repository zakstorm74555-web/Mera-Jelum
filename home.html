<!DOCTYPE html>
<html lang="ur" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…ÛŒØ±Ø§ Ø¬ÛÙ„Ù… - ÛÙˆÙ…</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-messaging-compat.js"></script>
    <style>
        :root { --primary: #004D40; --accent: #D4AF37; }
        body { margin: 0; background: #f0f2f5; font-family: 'Segoe UI'; padding-bottom: 100px; }
        .header { background: var(--primary); color: white; padding: 25px 20px; text-align: center; position: relative; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        .ribbon { position: absolute; top: 10px; right: -35px; background: #2e7d32; color: white; padding: 5px 40px; transform: rotate(45deg); font-size: 12px; font-weight: bold; border: 1px solid var(--accent); }
        .clock-section { background: white; margin: 15px; border-radius: 20px; padding: 25px; text-align: center; border: 2px solid var(--accent); box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        #clock { font-size: 3rem; margin: 0; color: var(--primary); font-weight: bold; }
        .tasbih-card { background: white; margin: 15px; border-radius: 25px; padding: 25px; text-align: center; border-bottom: 5px solid var(--primary); box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .counter-display { font-size: 4.5rem; font-weight: bold; color: var(--primary); margin: 10px 0; font-family: monospace; }
        .btn-tap { background: var(--primary); color: white; border: none; padding: 20px 0; width: 80%; border-radius: 50px; font-size: 22px; cursor: pointer; transition: 0.2s; box-shadow: 0 4px 10px rgba(0,77,64,0.3); }
        .btn-tap:active { transform: scale(0.95); }
        .btn-reset { background: none; color: #e57373; border: none; margin-top: 15px; cursor: pointer; font-size: 14px; }
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: white; display: flex; justify-content: space-around; padding: 15px 0; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); z-index: 100; }
        .nav-item { text-decoration: none; color: #666; font-size: 14px; text-align: center; }
        .nav-item.active { color: var(--primary); font-weight: bold; }
    </style>
</head>
<body onclick="unlockAudio()">

    <div class="header">
        <div class="ribbon">Ø±Ù…Ø¶Ø§Ù† Ù…Ø¨Ø§Ø±Ú©</div>
        <span style="font-size: 24px; font-weight: bold;">Ù…ÛŒØ±Ø§ Ø¬ÛÙ„Ù…</span>
    </div>

    <div class="clock-section">
        <div id="clock">00:00:00</div>
        <p style="margin: 5px 0 0; color: #666; letter-spacing: 2px;">JEHLUM TIME</p>
    </div>

    <div class="tasbih-card">
        <div style="color: #666; font-size: 14px; margin-bottom: 5px;">ØªØ³Ø¨ÛŒØ­ Ú©Ø§Ø¤Ù†Ù¹Ø±</div>
        <div id="counter" class="counter-display">0</div>
        <button class="btn-tap" onclick="countUp()">Ù¹ÛŒÙ¾ Ú©Ø±ÛŒÚº</button><br>
        <button class="btn-reset" onclick="resetCount()">Ø±ÛŒ Ø³ÛŒÙ¹ Ú©Ø§Ø¤Ù†Ù¹Ø±</button>
    </div>

    <audio id="audioAzaan" src="azaan.mp3" preload="auto"></audio>
    <audio id="audioSehri" src="sehri.mp3" preload="auto"></audio>
    <audio id="audioAftari" src="aftari.mp3" preload="auto"></audio>

    <nav class="bottom-nav">
        <a href="home.html" class="nav-item active">ğŸ <br>ÛÙˆÙ…</a>
        <a href="shops.html" class="nav-item">ğŸ›’<br>Ø¯Ú©Ø§Ù†ÛŒÚº</a>
        <a href="ratelist.html" class="nav-item">ğŸ§¾<br>Ø±ÛŒÙ¹ Ù„Ø³Ù¹</a>
        <a href="profile.html" class="nav-item">ğŸ‘¤<br>Ù¾Ø±ÙˆÙØ§Ø¦Ù„</a>
    </nav>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDey-KaC_Ty-dqijuQMWeQjtUx3eaaXc6k",
        authDomain: "mera-jehlum.firebaseapp.com",
        projectId: "mera-jehlum",
        messagingSenderId: "1093409222171",
        appId: "1:1093409222171:web:e9c1d2113c6bb7ae2952be"
    };
    firebase.initializeApp(firebaseConfig);
    const messaging = firebase.messaging();

    // --- 1. SERVICE WORKER REGISTRATION (Very Important) ---
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/firebase-messaging-sw.js')
        .then((registration) => {
            console.log('SW Registered:', registration);
            messaging.useServiceWorker(registration);
        });
    }

    let audioUnlocked = false;
    function unlockAudio() {
        if (!audioUnlocked) {
            ['audioAzaan', 'audioSehri', 'audioAftari'].forEach(id => {
                let a = document.getElementById(id);
                a.play().then(() => { a.pause(); a.currentTime = 0; }).catch(e => console.log("Unlock needed"));
            });
            audioUnlocked = true;
        }
    }

    // --- 2. TOKEN & HUGGING FACE SYNC ---
    messaging.getToken({ vapidKey: 'BETMouzl41jLq3vmn0tCz-ECN6iCkZ1PZQcVy68gpwahe-iPgygQFgYAr4Tp75TZeJYi35jJ79YE5feHsMM97O4' })
    .then((token) => {
        if (token) {
            // Space hata kar sahi URL check karein (Check if it's mera-jehlum or mera_jehlum)
            fetch("https://paradoxstudio9807-mera_jehlum.hf.space/subscribe", {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ token: token })
            })
            .then(res => res.json())
            .then(data => console.log("Subscribed:", data))
            .catch(err => console.error("Sub Error:", err));
        }
    });

    // --- 3. LIVE MESSAGE HANDLER ---
    messaging.onMessage((payload) => {
        console.log('Signal Received:', payload);
        const title = payload.notification.title;
        if (title.includes("Ø³Ø­Ø±ÛŒ")) document.getElementById('audioSehri').play();
        else if (title.includes("Ø§ÙØ·Ø§Ø±ÛŒ")) document.getElementById('audioAftari').play();
        else document.getElementById('audioAzaan').play();
        
        alert(title + "\n" + payload.notification.body);
    });

    // --- 4. TASBIH & CLOCK ---
    let count = localStorage.getItem('tasbihCount') || 0;
    document.getElementById('counter').innerText = count;
    function countUp() { unlockAudio(); count++; document.getElementById('counter').innerText = count; localStorage.setItem('tasbihCount', count); if (navigator.vibrate) navigator.vibrate(40); }
    function resetCount() { if(confirm("Ø±ÛŒ Ø³ÛŒÙ¹ØŸ")) { count = 0; document.getElementById('counter').innerText = 0; localStorage.setItem('tasbihCount', 0); } }
    function updateClock() { document.getElementById('clock').innerText = new Date().toLocaleTimeString('en-GB'); }
    setInterval(updateClock, 1000);
    updateClock();
</script>
</body>
</html>
