<!DOCTYPE html>
<html lang="ur" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…ÛŒØ±Ø§ Ø¬ÛÙ„Ù… - Ù¾Ø±ÙˆÙØ§Ø¦Ù„</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <style>
        :root { --primary: #004D40; --accent: #D4AF37; }
        body { margin: 0; background: #f0f2f5; font-family: 'Segoe UI'; padding-bottom: 80px; }
        .profile-header { background: var(--primary); color: white; padding: 40px 20px; text-align: center; border-radius: 0 0 40px 40px; }
        .user-img { width: 100px; height: 100px; border-radius: 50%; border: 4px solid var(--accent); margin-bottom: 10px; }
        .form-card { background: white; margin: -30px 20px 20px 20px; padding: 25px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h3 { color: var(--primary); margin-top: 0; }
        .input-group { margin-bottom: 15px; }
        input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; }
        .btn-save { background: var(--accent); color: var(--primary); border: none; width: 100%; padding: 15px; border-radius: 10px; font-weight: bold; font-size: 16px; cursor: pointer; transition: 0.3s; }
        .btn-save:hover { background: #b8962d; }
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: white; display: flex; justify-content: space-around; padding: 15px 0; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); }
        .nav-item { text-decoration: none; color: #666; font-size: 14px; text-align: center; }
    </style>
</head>
<body>

    <div class="profile-header">
        <img id="display-photo" src="https://via.placeholder.com/100" class="user-img">
        <h2 id="display-name">ØµØ§Ø±Ù Ú©Ø§ Ù†Ø§Ù…</h2>
    </div>

    <div class="form-card">
        <h3>Ø§Ù¾Ù†ÛŒ Ø¯Ú©Ø§Ù† Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº ğŸª</h3>
        <div class="input-group">
            <input type="text" id="shop-name" placeholder="Ø¯Ú©Ø§Ù† Ú©Ø§ Ù†Ø§Ù… (Ù…Ø«Ù„Ø§Ù‹: Ø¬ÛÙ„Ù… ÙÙˆÚˆØ²)">
        </div>
        <div class="input-group">
            <input type="text" id="map-link" placeholder="Ú¯ÙˆÚ¯Ù„ Ù…ÛŒÙ¾ Ù„Ù†Ú©">
        </div>
        <div class="input-group">
            <label style="font-size: 13px; color: grey;">Ø¯Ú©Ø§Ù† Ú©ÛŒ ØªØµÙˆÛŒØ± Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº:</label>
            <input type="file" id="shop-image" accept="image/*" style="border: none;">
        </div>
        <button id="save-btn" onclick="saveShopData()" class="btn-save">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…Ø­ÙÙˆØ¸ Ú©Ø±ÛŒÚº</button>
    </div>

    <nav class="bottom-nav">
        <a href="home.html" class="nav-item">ğŸ <br>ÛÙˆÙ…</a>
        <a href="shops.html" class="nav-item">ğŸ›’<br>Ø¯Ú©Ø§Ù†ÛŒÚº</a>
        <a href="profile.html" class="nav-item active" style="color: var(--primary); font-weight: bold;">ğŸ‘¤<br>Ù¾Ø±ÙˆÙØ§Ø¦Ù„</a>
    </nav>

    <script>
        // --- CONFIGURATIONS ---
        const firebaseConfig = {
  apiKey: "AIzaSyDey-KaC_Ty-dqijuQMWeQjtUx3eaaXc6k",
  authDomain: "mera-jehlum.firebaseapp.com",
  databaseURL: "https://mera-jehlum-default-rtdb.firebaseio.com",
  projectId: "mera-jehlum",
  storageBucket: "mera-jehlum.firebasestorage.app",
  messagingSenderId: "1093409222171",
  appId: "1:1093409222171:web:e9c1d2113c6bb7ae2952be",
  measurementId: "G-VLPHNJKZ8P"
};
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const CLOUDINARY_URL = "https://api.cloudinary.com/v1_1/dxhiopwak/image/upload";
        const CLOUDINARY_PRESET = "meranjehlum";

        // Load User Info from LocalStorage
        document.getElementById('display-name').innerText = localStorage.getItem("user_name") || "ØµØ§Ø±Ù";
        document.getElementById('display-photo').src = localStorage.getItem("user_photo") || "https://via.placeholder.com/100";

        async function saveShopData() {
            const btn = document.getElementById('save-btn');
            const shopName = document.getElementById('shop-name').value;
            const mapLink = document.getElementById('map-link').value;
            const file = document.getElementById('shop-image').files[0];

            if(!shopName || !file) return alert("Ø¨Ø±Ø§Û Ú©Ø±Ù… ØªÙ…Ø§Ù… Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙØ±Ø§ÛÙ… Ú©Ø±ÛŒÚº!");

            btn.innerText = "Ø§Ù¾Ù„ÙˆÚˆÙ†Ú¯ Ø¬Ø§Ø±ÛŒ ÛÛ’...";
            btn.disabled = true;

            try {
                // 1. Upload Image to Cloudinary
                const formData = new FormData();
                formData.append('file', file);
                formData.append('upload_preset', CLOUDINARY_PRESET);

                const res = await fetch(CLOUDINARY_URL, { method: 'POST', body: formData });
                const json = await res.json();
                const imageUrl = json.secure_url;

                // 2. Save Data to Firebase Realtime Database
                await db.ref('shops').push({
                    shop_name: shopName,
                    map_link: mapLink,
                    image_url: imageUrl,
                    owner: localStorage.getItem("user_name"),
                    rating: 5.0
                });

                alert("Ù…Ø¨Ø§Ø±Ú© ÛÙˆ! Ø¢Ù¾ Ú©ÛŒ Ø¯Ú©Ø§Ù† Ø±Ø¬Ø³Ù¹Ø± ÛÙˆ Ú¯Ø¦ÛŒ ÛÛ’Û”");
                window.location.href = "shops.html";

            } catch (err) {
                alert("Ú©Ú†Ú¾ ØºÙ„Ø· ÛÙˆ Ú¯ÛŒØ§Û” Ø¯ÙˆØ¨Ø§Ø±Û Ú©ÙˆØ´Ø´ Ú©Ø±ÛŒÚº!");
                console.error(err);
            } finally {
                btn.innerText = "Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…Ø­ÙÙˆØ¸ Ú©Ø±ÛŒÚº";
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>
